{"version":3,"file":"vue.js","sources":["../src/array.js","../src/utils.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["let oldArrayPrototype = Array.prototype;\nexport let arrayMethods = Object.create(oldArrayPrototype);\n\nlet methods= ['push', 'shift', 'pop','unshift','reverse','splice','sort'];\nmethods.forEach(method=>{\n    arrayMethods[method] = function(...args){ // args参数列表  arr.push(1,2,3)  ...args = [1,2,3]\n      //  console.log(\"方法被调用了\"); \n        oldArrayPrototype[method].call(this, ...args)\n    }\n})","export function isfn(fn){\n    return typeof fn === \"function\";\n}\n\nexport function isObject(obj){\n  return typeof obj =='object' && obj != null;\n}","\nimport { arrayMethods } from \"../array\";\nimport { isObject } from \"../utils\";\n\n// 检测数据的变化 \nclass Observer {\n   constructor(data){  // 对对象中的所有属性进行劫持\n     if(Array.isArray(data)){\n        // 数据劫持的逻辑  劫持数组的变异方法（变异方法:指操作方法可能会改变原数组如： push shift pop 而contact不是变异方法，因其不会改变原数组）\n        // 对数组原来的方法进行改写（重写？）----> 切片编程 高阶函数\n        data.__proto__ = arrayMethods;\n        // 如果数组中的数据是对象，则需要对对象进行劫持 [{key:value}, {key:value}]\n        this.observeArray(data);\n      \n     }else{\n        this.walk(data); // 对象劫持的逻辑\n     }   \n   }\n   observeArray(data){\n     data.forEach(item=>{\n        observe(item);\n     });\n   }\n   walk(data){ // data数据对象\n      Object.keys(data).forEach(key=>{\n         defineReactive(data,key,data[key])\n      })\n   }\n}\n\n// vue2会对对象进行遍历(递归)， 将每个对象用 Object.defineProperty重新定义， 性能差!!!\nfunction defineReactive(data,key, value){\n   observe(value);  // 如果对象属性的值为对象，则递归劫持对象属性 ，所以在使用Vue2的时候，尽量将数据扁平化不要过多嵌套  \n   Object.defineProperty(data, key, {\n     get(){\n        console.log(key+\"get了\");\n        return value;\n     },\n     set(newValue){\n        console.log(key+\"set 了\");\n        observe(newValue); // 如果对象的某个属性重新赋的值也是一个对象，则也需要被劫持。\n        value = newValue;\n     }\n   });\n} \n/**\n * 问题： 给data添加属性会被劫持到吗？\n * \n * */ \n\n//数据观察者模式\nexport function observe(data){\n  // vue2中会将所有的data数据进行数据劫持？什么是数据劫持？ Object.defineproperty \n  // 如果是对象才进行观测\n if(!isObject(data)){\n   return;\n }\n\n // 进行观测  默认最外层的data必须是一个对象\n  return new Observer(data);\n}","import { observe } from \"./observer/index\";\nimport { isfn } from \"./utils\";\n\n// 数据状态初始化\nexport function initState(vm) {\n    const opts = vm.$options;\n    if (opts.data) {\n        initData(vm);\n    }\n}\nfunction initData(vm) {\n    let data = vm.$options.data;\n\n    // 此时data和vm没有任何关系  data = isfn(data) ? data.call(vm) : data;  解决：\n\n    data =vm._data= isfn(data) ? data.call(vm) : data; // 判断data是函数还是json对象 \n    //   vue2中会将所有的data数据进行数据劫持？什么是数据劫持？ Object.defineproperty \n    // vm.name ----> vm._data.name\n    for(let key in data){\n        proxy(vm, \"_data\", key);\n    }\n    observe(data);\n}\n\nfunction proxy(vm,source, key){\n  Object.defineProperty(vm,key,{\n    get(){\n       return vm[source][key];\n    },\n    set(newValue){\n       vm[source][key] = newValue;\n    }\n  } );\n}\n\n","import { initState } from \"./state\";\n\n// initMixin函数用于在vue原型添加init初始化方法\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this;\n        vm.$options = options;\n\n        // 对数据进行初始化 data el methods computed props\n        initState(vm);\n    }\n}","import { initMixin } from \"./init\";\n\n// 定义Vue构造函数 \nfunction Vue(options) {\n    this._init(options);  // options vue实例的配置项{ el data methods等}\n}\ninitMixin(Vue); // 此函数将_init方法添加到Vue原型上\nexport default Vue;\n\n"],"names":["oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","isfn","fn","isObject","obj","Observer","data","isArray","__proto__","observeArray","walk","item","observe","keys","key","defineReactive","value","defineProperty","get","console","log","set","newValue","initState","vm","opts","$options","initData","_data","proxy","source","initMixin","Vue","_init","options"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA,IAAIA,iBAAiB,GAAGC,KAAK,CAACC,SAA9B,CAAA;EACO,IAAIC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcL,iBAAd,CAAnB,CAAA;EAEP,IAAIM,OAAO,GAAE,CAAC,MAAD,EAAS,OAAT,EAAkB,KAAlB,EAAwB,SAAxB,EAAkC,SAAlC,EAA4C,QAA5C,EAAqD,MAArD,CAAb,CAAA;EACAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAE;EACpBL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,YAAiB;EAAA,IAAA,IAAA,qBAAA,CAAA;;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAALC,IAAK,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAALA,IAAK,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EAAE;EACxC;MACE,CAAAT,qBAAAA,GAAAA,iBAAiB,CAACQ,MAAD,CAAjB,EAA0BE,IAA1B,CAAA,KAAA,CAAA,qBAAA,EAAA,CAA+B,IAA/B,CAAA,CAAA,MAAA,CAAwCD,IAAxC,CAAA,CAAA,CAAA;KAFJ,CAAA;EAIH,CALD,CAAA;;ECJO,SAASE,IAAT,CAAcC,EAAd,EAAiB;IACpB,OAAO,OAAOA,EAAP,KAAc,UAArB,CAAA;EACH,CAAA;EAEM,SAASC,QAAT,CAAkBC,GAAlB,EAAsB;EAC3B,EAAA,OAAO,QAAOA,GAAP,CAAA,IAAa,QAAb,IAAyBA,GAAG,IAAI,IAAvC,CAAA;EACD;;MCDKC;EACH,EAAA,SAAA,QAAA,CAAYC,IAAZ,EAAiB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EAAG;EAClB,IAAA,IAAGf,KAAK,CAACgB,OAAN,CAAcD,IAAd,CAAH,EAAuB;EACpB;EACA;EACAA,MAAAA,IAAI,CAACE,SAAL,GAAiBf,YAAjB,CAHoB;;QAKpB,IAAKgB,CAAAA,YAAL,CAAkBH,IAAlB,CAAA,CAAA;EAEF,KAPD,MAOK;EACF,MAAA,IAAA,CAAKI,IAAL,CAAUJ,IAAV,CAAA,CADE;EAEJ,KAAA;EACF,GAAA;;;;EACD,IAAA,KAAA,EAAA,SAAA,YAAA,CAAaA,IAAb,EAAkB;EAChBA,MAAAA,IAAI,CAACT,OAAL,CAAa,UAAAc,IAAI,EAAE;UAChBC,OAAO,CAACD,IAAD,CAAP,CAAA;SADH,CAAA,CAAA;EAGD,KAAA;;;EACD,IAAA,KAAA,EAAA,SAAA,IAAA,CAAKL,IAAL,EAAU;EAAE;QACTZ,MAAM,CAACmB,IAAP,CAAYP,IAAZ,EAAkBT,OAAlB,CAA0B,UAAAiB,GAAG,EAAE;UAC5BC,cAAc,CAACT,IAAD,EAAMQ,GAAN,EAAUR,IAAI,CAACQ,GAAD,CAAd,CAAd,CAAA;SADH,CAAA,CAAA;EAGF,KAAA;;;;EAGJ,CAAA,EAAA,CAAA;;;EACA,SAASC,cAAT,CAAwBT,IAAxB,EAA6BQ,GAA7B,EAAkCE,KAAlC,EAAwC;EACrCJ,EAAAA,OAAO,CAACI,KAAD,CAAP,CADqC;;EAErCtB,EAAAA,MAAM,CAACuB,cAAP,CAAsBX,IAAtB,EAA4BQ,GAA5B,EAAiC;EAC/BI,IAAAA,GAD+B,EAC1B,SAAA,GAAA,GAAA;EACFC,MAAAA,OAAO,CAACC,GAAR,CAAYN,GAAG,GAAC,MAAhB,CAAA,CAAA;EACA,MAAA,OAAOE,KAAP,CAAA;OAH4B;MAK/BK,GAL+B,EAAA,SAAA,GAAA,CAK3BC,QAL2B,EAKlB;EACVH,MAAAA,OAAO,CAACC,GAAR,CAAYN,GAAG,GAAC,OAAhB,CAAA,CAAA;EACAF,MAAAA,OAAO,CAACU,QAAD,CAAP,CAFU;;EAGVN,MAAAA,KAAK,GAAGM,QAAR,CAAA;EACF,KAAA;KATH,CAAA,CAAA;EAWF,CAAA;EACD;EACA;EACA;EACA;EAEA;;;EACO,SAASV,OAAT,CAAiBN,IAAjB,EAAsB;EAC3B;EACA;EACD,EAAA,IAAG,CAACH,QAAQ,CAACG,IAAD,CAAZ,EAAmB;EACjB,IAAA,OAAA;EACD,GAL2B;;;EAQ3B,EAAA,OAAO,IAAID,QAAJ,CAAaC,IAAb,CAAP,CAAA;EACD;;ECxDM,SAASiB,SAAT,CAAmBC,EAAnB,EAAuB;EAC1B,EAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAAA;;IACA,IAAID,IAAI,CAACnB,IAAT,EAAe;MACXqB,QAAQ,CAACH,EAAD,CAAR,CAAA;EACH,GAAA;EACJ,CAAA;;EACD,SAASG,QAAT,CAAkBH,EAAlB,EAAsB;IAClB,IAAIlB,IAAI,GAAGkB,EAAE,CAACE,QAAH,CAAYpB,IAAvB,CADkB;;EAKlBA,EAAAA,IAAI,GAAEkB,EAAE,CAACI,KAAH,GAAU3B,IAAI,CAACK,IAAD,CAAJ,GAAaA,IAAI,CAACN,IAAL,CAAUwB,EAAV,CAAb,GAA6BlB,IAA7C,CALkB;EAMlB;EACA;;EACA,EAAA,KAAI,IAAIQ,GAAR,IAAeR,IAAf,EAAoB;EAChBuB,IAAAA,KAAK,CAACL,EAAD,EAAK,OAAL,EAAcV,GAAd,CAAL,CAAA;EACH,GAAA;;IACDF,OAAO,CAACN,IAAD,CAAP,CAAA;EACH,CAAA;;EAED,SAASuB,KAAT,CAAeL,EAAf,EAAkBM,MAAlB,EAA0BhB,GAA1B,EAA8B;EAC5BpB,EAAAA,MAAM,CAACuB,cAAP,CAAsBO,EAAtB,EAAyBV,GAAzB,EAA6B;EAC3BI,IAAAA,GAD2B,EACtB,SAAA,GAAA,GAAA;EACF,MAAA,OAAOM,EAAE,CAACM,MAAD,CAAF,CAAWhB,GAAX,CAAP,CAAA;OAFwB;MAI3BO,GAJ2B,EAAA,SAAA,GAAA,CAIvBC,QAJuB,EAId;EACVE,MAAAA,EAAE,CAACM,MAAD,CAAF,CAAWhB,GAAX,IAAkBQ,QAAlB,CAAA;EACF,KAAA;KANH,CAAA,CAAA;EAQD;;EC9BM,SAASS,SAAT,CAAmBC,GAAnB,EAAwB;EAC3BA,EAAAA,GAAG,CAACxC,SAAJ,CAAcyC,KAAd,GAAsB,UAAUC,OAAV,EAAmB;MACrC,IAAMV,EAAE,GAAG,IAAX,CAAA;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcQ,OAAd,CAFqC;;MAKrCX,SAAS,CAACC,EAAD,CAAT,CAAA;KALJ,CAAA;EAOH;;ECRD,SAASQ,GAAT,CAAaE,OAAb,EAAsB;EAClB,EAAA,IAAA,CAAKD,KAAL,CAAWC,OAAX,CAAA,CADkB;;EAErB,CAAA;;EACDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}